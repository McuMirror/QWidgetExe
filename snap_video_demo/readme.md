
## 前言说明
1. 如果采用qmedia内核，需要先安装LAVFilters或者K-Lite，发布的可执行文件目录下会提供LAVFilters.exe。
2. 编译好之后记得将动态库文件比如dll_ffmpeg4（如果是vlc内核则是dll_vlc3）下面的所有文件复制到可执行文件同一目录。
3. 编译后生成的可执行文件在当前项目源码下的bin目录中。
4. 动态库区分32和64位，对应动态库目录后面有_64字样表示是64位的库。
5. 动态库下载链接: https://pan.baidu.com/s/13LDRu6mXC6gaADtrGprNVA 提取码: ujm7
6. 项目作品大全: https://qtchina.blog.csdn.net/article/details/97565652

## 基础功能
1. 支持各种音频视频文件格式，比如mp3、wav、mp4、asf、rm、rmvb、mkv等。
2. 支持本地摄像头设备，可指定分辨率、帧率。
3. 支持各种视频流格式，比如rtp、rtsp、rtmp、http等。
4. 本地音视频文件和网络音视频文件，自动识别文件长度、播放进度、音量大小、静音状态等。
5. 文件可以指定播放位置、调节音量大小、设置静音状态等。
6. 支持倍速播放文件，可选0.5倍、1.0倍、2.5倍、5.0倍等速度，相当于慢放和快放。
7. 支持开始播放、停止播放、暂停播放、继续播放。
8. 支持抓拍截图，可指定文件路径，可选抓拍完成是否自动显示预览。
8. 支持录像存储，手动开始录像、停止录像，部分内核支持暂停录像后继续录像，跳过不需要录像的部分。
9. 支持无感知切换循环播放、自动重连等机制。
10. 提供播放成功、播放完成、收到解码图片、收到抓拍图片、视频尺寸变化、录像状态变化等信号。
11. 多线程处理，一个解码一个线程，不卡主界面。

## 特色功能
1. 同时支持多种解码内核，包括qmedia内核（Qt4/Qt5/Qt6）、ffmpeg内核（ffmpeg2/ffmpeg3/ffmpeg4/ffmpeg5）、vlc内核（vlc2/vlc3）、mpv内核（mpv1/mp2）、海康sdk、easyplayer内核等。
2. 非常完善的多重基类设计，新增一种解码内核只需要实现极少的代码量，就可以应用整套机制。
3. 同时支持多种画面显示策略，自动调整（原始分辨率小于显示控件尺寸则按照原始分辨率大小显示，否则等比例缩放）、等比例缩放（永远等比例缩放）、拉伸填充（永远拉伸填充）。所有内核和所有视频显示模式下都支持三种画面显示策略。
4. 同时支持多种视频显示模式，句柄模式（传入控件句柄交给对方绘制控制）、绘制模式（回调拿到数据后转成QImage用QPainter绘制）、GPU模式（回调拿到数据后转成yuv用QOpenglWidget绘制）。
5. 支持多种硬件加速类型，ffmpeg可选dxva2、d3d11va等，mpv可选auto、dxva2、d3d11va，vlc可选any、dxva2、d3d11va。不同的系统环境有不同的类型选择，比如linux系统有vaapi、vdpau，macos系统有videotoolbox。
6. 解码线程和显示窗体分离，可指定任意解码内核挂载到任意显示窗体，动态切换。
7. 支持共享解码线程，默认开启并且自动处理，当识别到相同的视频地址，共享一个解码线程，在网络视频环境中可以大大节约网络流量以及对方设备的推流压力。国内顶尖视频厂商均采用此策略。这样只要拉一路视频流就可以共享到几十个几百个通道展示。
8. 自动识别视频旋转角度并绘制，比如手机上拍摄的视频一般是旋转了90度的，播放的时候要自动旋转处理，不然默认是倒着的。
9. 自动识别视频流播放过程中分辨率的变化，在视频控件上自动调整尺寸。比如摄像机可以在使用过程中动态配置分辨率，当分辨率改动后对应视频控件也要做出同步反应。
10. 音视频文件无感知自动切换循环播放，不会出现切换期间黑屏等肉眼可见的切换痕迹。
11. 视频控件同时支持任意解码内核、任意画面显示策略、任意视频显示模式。
12. 视频控件悬浮条同时支持句柄、绘制、GPU三种模式，非绝对坐标移来移去。
13. 本地摄像头设备支持指定设备名称、分辨率、帧率进行播放。
14. 录像文件同时支持打开的视频文件、本地摄像头、网络视频流等。
15. 瞬间响应打开和关闭，无论是打开不存在的视频或者网络流，探测设备是否存在，读取中的超时等待，收到关闭指令立即中断之前的操作并响应。
16. 支持打开各种图片文件，支持本地音视频文件拖曳播放。
17. 视频控件悬浮条自带开始和停止录像切换、声音静音切换、抓拍截图、关闭视频等功能。
18. 音频组件支持声音波形值数据解析，可以根据该值绘制波形曲线和柱状声音条，默认提供了声音振幅信号。
19. 代码框架和结构优化到最优，性能强悍，持续迭代更新升级。
20. 源码支持Qt4、Qt5、Qt6，兼容所有版本。

## 视频控件
1. 可动态添加任意多个osd标签信息，标签信息包括名字、是否可见、字号大小、文本文字、文本颜色、标签图片、标签坐标、标签格式（文本、日期、时间、日期时间、图片）、标签位置（左上角、左下角、右上角、右下角、居中、自定义坐标）。
2. 可动态添加任意多个图形信息，这个非常有用，比如人工智能算法解析后的图形区域信息直接发给视频控件即可。图形信息支持任意形状，直接绘制在原始图片上，采用绝对坐标。
3. 图形信息包括名字、边框大小、边框颜色、背景颜色、矩形区域、路径集合、点坐标集合等。
4. 每个图形信息都可指定三种区域中的一种或者多种，指定了的都会绘制。
5. 内置悬浮条控件，悬浮条位置支持顶部、底部、左侧、右侧。
6. 悬浮条控件参数包括边距、间距、背景透明度、背景颜色、文本颜色、按下颜色、位置、按钮图标代码集合、按钮名称标识集合、按钮提示信息集合。
7. 悬浮条控件一排工具按钮可自定义，通过结构体参数设置，图标可选图形字体还是自定义图片。
8. 悬浮条按钮内部实现了录像切换、抓拍截图、静音切换、关闭视频等功能，也可以自行在源码中增加自己对应的功能。
9. 悬浮条按钮对应实现了功能的按钮，有对应图标切换处理，比如录像按钮按下后会切换到正在录像中的图标，声音按钮切换后变成静音图标，再次切换还原。
10. 悬浮条按钮单击后都用名称唯一标识作为信号发出，可以自行关联响应处理。
11. 悬浮条空白区域可以显示提示信息，默认显示当前视频分辨率大小，可以增加帧率、码流大小等信息。
12. 视频控件参数包括边框大小、边框颜色、焦点颜色、背景颜色（默认透明）、文字颜色（默认全局文字颜色）、填充颜色（视频外的空白处填充黑色）、背景文字、背景图片（如果设置了图片优先取图片）、是否拷贝图片、缩放显示模式（自动调整、等比例缩放、拉伸填充）、视频显示模式（句柄、绘制、GPU）、启用悬浮条、悬浮条尺寸（横向为高度、纵向为宽度）、悬浮条位置（顶部、底部、左侧、右侧）。

## 内核qmedia
1. 支持各种音视频文件、各种视频流网络流。
2. 支持开始播放、暂停播放、继续播放、停止播放、设置播放进度、倍速播放。
3. 可设置音量、静音切换、抓拍图片。
4. 自动提取专辑信息比如标题、艺术家、专辑、专辑封面，自动显示专辑封面。
5. 事件机制响应文件长度变化、播放进度变化、音量大小变化、静音状态变化、分辨率变化等。
6. 句柄模式显示悬浮条和osd标签控件，非绝对坐标move来move去这种垃圾方式。
7. 同时支持句柄和绘制两种模式，可拿到每一帧的图片数据，Qt4/Qt5采用QAbstractVideoSurface，Qt6采用QVideoSink。
8. 全宇宙唯一同时支持Qt4、Qt5、Qt6版本的播放器类，对应类qmediathread4.h、qmediathread5.h、qmediathread6.h。

## 内核ffmpeg
1. 支持各种音视频文件、本地摄像头设备，各种视频流网络流。
2. 支持开始播放、暂停播放、继续播放、停止播放、设置播放进度、倍速播放。
3. 可设置音量、静音切换、抓拍图片、录像存储。
4. 自动提取专辑信息比如标题、艺术家、专辑、专辑封面，自动显示专辑封面。
5. 完美支持音视频同步和倍速播放。
6. 解码策略支持速度优先、质量优先、均衡处理、最快速度。
7. 支持手机视频旋转角度显示，比如一般手机拍摄的视频是旋转了90度的，解码显示的时候需要重新旋转90度才是正的。
8. 自动转换yuv420格式，比如本地摄像头是yuyv422格式，有些视频文件是xx格式，统一将非yuv420格式转换，然后再进行处理。
9. 支持硬解码dxva2、d3d11va等，性能极高尤其是大分辨率比如4K视频。
10. 视频响应极低延迟0.2s左右，极速响应打开视频流0.5s左右，专门做了优化处理。
11. 硬解码和GPU绘制组合，极低CPU占用，比海康大华等客户端更优。
12. 支持视频流中的各种音频格式，AAC、PCM、G.726、G.711A、G.711Mu、G.711ulaw、G.711alaw、MP2L2等都支持，推荐选择AAC兼容性跨平台性最好。
13. 视频存储支持yuv、h264、mp4多种格式，音频存储支持pcm、wav、aac多种格式。默认视频mp4格式、音频aac格式。
14. 支持分开存储音频视频文件，也支持合并到一个mp4文件，默认策略是无论何种音视频文件格式存储，最终都转成mp4及aac格式，然后合并成音视频一起的mp4文件。
15. 支持本地摄像头实时视频显示带音频输入输出，音视频录制合并到一个mp4文件。
16. 支持H264/H265编码（现在越来越多的监控摄像头是H265视频流格式）生成视频文件，内部自动识别切换编码格式。
17. 自动识别视频流动态分辨率改动，重新打开视频流。
18. 支持用户信息中包含特殊字符（比如用户信息中包含+#@等字符）的视频流播放，内置解析转义处理。
19. 纯qt+ffmpeg解码，非sdl等第三方绘制播放依赖，gpu绘制采用qopenglwidget，音频播放采用qaudiooutput。
20. 同时支持ffmpeg2、ffmpeg3、ffmpeg4、ffmpeg5版本，全部做了兼容处理。如果需要支持xp需要选用ffmpeg3及以下。

## 内核vlc
1. 支持各种音视频文件、本地摄像头设备，各种视频流网络流。
2. 支持开始播放、暂停播放、继续播放、停止播放、设置播放进度、倍速播放。
3. 可设置音量、静音切换、抓拍图片、录像存储。
4. 自动提取专辑信息比如标题、艺术家、专辑、专辑封面，自动显示专辑封面。
5. 事件回调机制响应文件长度变化、播放进度变化、音量大小变化、静音状态变化、分辨率变化等。
6. 不用重新编译源码，实现句柄模式下响应鼠标键盘信息。
7. 不用重新编译源码，实现录像文件存储。手动开启录像和停止录像，录像文件名称自动调整为设置的名称。
8. 句柄模式显示悬浮条和osd标签控件，非绝对坐标move来move去这种垃圾方式。
9. 支持硬解码any、dxva2、d3d11va等，性能极高尤其是大分辨率比如4K视频。
10. 同时支持vlc2、vlc3版本，全部做了兼容处理。

## 内核mpv
1. 支持各种音视频文件、各种视频流网络流包括监控设备视频流。
2. 支持开始播放、暂停播放、继续播放、停止播放、设置播放进度、倍速播放。
3. 可设置音量、静音切换、抓拍图片、录像存储。
4. 事件回调机制响应文件长度变化、播放进度变化、音量大小变化、静音状态变化、分辨率变化等。
5. 可自由设置分辨率宽高比，包括运行过程中设置。
6. 通用获取属性和设置属性函数，帮助文档找到对应属性列表，全部可以动态执行获取和设置。
7. 支持硬解码auto、dxva2、d3d11va等，性能极高尤其是大分辨率比如4K视频。
8. 同时支持mpv1、mpv2版本，全部做了兼容处理。

## 内核海康sdk
1. 支持海康设备视频流、MP4录像文件、本地MP4视频文件播放。
2. 支持windows、linux系统，支持32位、64位的库。
3. 支持句柄、绘制（回调拿到数据转QImage绘制）、GPU（回调拿到数据转yuv用QOpenGLWidget绘制）三种视频显示模式。
4. 本地文件支持开始播放、暂停播放、继续播放、停止播放、设置播放进度、倍速播放。
5. 可设置音量、静音切换、抓拍图片、录像存储。
6. 回调除了拿到图片数据还支持拿到音频数据并播放。
7. 可以获取每一帧的世界时间，比如 2022-09-08 11:11:11 000 表示该帧在 2022-09-08 11:11:11 000 存储的，可以很方便用于回放录像标记。

## 内核easyplayer
1. 支持各种音视频文件、各种视频流网络流包括监控设备视频流。
2. 支持本地摄像头设备播放。
3. 支持开始播放、暂停播放、继续播放、停止播放、设置播放进度、倍速播放。
4. 可设置音量、静音切换、抓拍图片、录像存储。
5. 可以开启音频可视化显示，可选波形和频谱两种方式。
6. 变速播放声音自动去噪，听起来柔和平滑。
7. 支持h264/h265编码生成视频文件，根据源头自动识别处理。

## 特别说明
1. 共享解码线程不支持句柄模式，必须是绘制模式或者GPU模式。目前支持共享解码线程的有qmedia内核绘制模式、ffmpeg内核绘制模式、ffmpeg内核GPU模式、vlc内核绘制模式、海康sdk内核绘制模式、海康sdk内核GPU模式等。
2. vlc和mpv内核对超过12路通道支持不友好，性能急剧暴跌。因为播放器的设计初衷是在电脑上同时播放1-8路视频，超过8路的场景不建议使用vlc和mpv内核。
3. 跨平台最好的内核是ffmpeg内核，强烈推荐此内核。
4. 如果只是当普通播放器在本地使用，推荐mpv和vlc内核。
5. 如果嵌入式板子上厂家移植好了硬解码到QMediaPlayer模块，推荐qmedia内核。
6. 视频显示模式受限于具体的解码内核支持，比如目前mpv内核只有句柄模式，vlc内核只有句柄和绘制模式，ffmpeg内核只有绘制和GPU模式，海康内核支持三种模式。
7. 视频控件支持的图形信息，只支持绘制模式，只有绘制模式才能把图形信息绘制到原始图片上。
8. 录像文件存储除了ffmpeg内核外（可选分开存储还是合并存储），其他内核都是音视频一起存储到一个文件。
9. 在qmedia内核有几个缺点：Qt5中句柄模式不能获取到分辨率等信息，需要切换到QAbstractVideoSurface获取到以后再返回；Qt6性能爆表，但是目前还不支持网络流比如rtsp视频流，很奇怪的是Qt5反而支持。
10. Qt6.0到Qt6.2之间的版本由于缺失多媒体模块所以无法使用qmedia内核。
11. ffmpeg内核最快速度解码策略：速度优先并且不做音视频同步，打开不等待缓存，一般在特定视频流环境中需要，对响应速度有要求的。
12. vlc内核如果同时打开多路视频流建议缓存设置大一些，不然CPU占用极高容易崩溃。
13. mpv内核有内存泄漏迹象，和mpv动态库有关。
14. linux安装 apt-get install gstreamer1.0-libav。https://blog.csdn.net/MoonShapedPool/article/details/82835565
15. 画面选择拉伸填充标签效果最佳，画面选择自动调整图形效果最佳。
16. Qt4中音频组件不能调节声音大小。
17. Qt5.6以下的多媒体模块视频没有图像，QAbstractVideoSurface也获取不到图像。
18. vlc内核和mpv内核在保存阶段不建议切换播放进度，vlc内部强制不允许切换，mpv切换了会保存错乱。
19. ffmpeg内核支持保存阶段切换播放进度，因为底层是自己写的代码处理的保存，做了特殊处理。
20. qmedia内核暂时不支持保存文件，有对应的类但是Qt底层没实现，坐等他实现。